一 概念：CDN是内容分发网络（Content Distribute Network），其功能是源站加速即将源站信息放在CDN网络的各个节点上让用户可以更快获取。






二 原理：详看阿里云CDN原理图，那张图超级棒。CDN的核心原理就是控制了域名解析的过程即将源站域名解析到cname记录而不是A记录，再由CDN的dns调度系统根据cname记录分配最佳节点IP，再由调度系统将这个IP地址响应回客户端，这个过程全发生在DNS中，此时连接还没建立。这样，客户端拿到以后就和CDN进行直接通信而不是源站，这样就快了，但是对客户端而言这是透明的。另外如果在数据通信过程中，CDN节点没有客户端请求的资源，那么CDN就去找源站拉。另外如果CDN的连接资源快被耗尽了（一般会设置一个值，但是这很难，因为CDN节点一般很多，对DDoS攻击的成本要求很高），那么CDN的DNS调度系就会响应源站IP给客户端。






三 DCDN和CDN的区别：DCDN是全站加速，不光加速静态资源也加速动态资源（直播这种），CDN只加速静态资源。






四 如何配置CDN？
1 在CDN服务提供商那配置源站信息，拿到CDN给你分配的CNAME记录值，配置CDN的相关信息比如是否开启websocket；
2 在DNS服务提供商那配置 <域名, CNAME记录值> 这样一条记录，这叫域名解析记录或者域名查询记录。






五 功能
1 CDN出现的本意是为了加速静态资源的获取，这是符合前后端分离的历史大趋势的。
2 但是人们也发现了CDN是可以防溯源的。
是的，在APT工具中，使用CDN防溯源是很常用的手段。
你需要让自己的CDN转发websocket流量，做法如下：
（1）开发：
a RAT：
你需要开发一个代理websocket流量的服务，该服务位于nginx和RAT之间用于对ws流量做协议封装和解析。
b 后门：你需要开发一个代理websocket流量的客户端，用于ws流量的协议封装和解析。
（2）配置：
a RAT：配置nginx为127.0.0.1:ws-serv-port提供反向代理服务。
b 后门：需要让后门以ws://server-domain/path这样的URL进行回连，其中ws是不加密的CDN、wss是加密的，server-domain即是cc的域名而不是cname域名，path是你在反向代理服务器给websocket服务器配置的路径。






四 如何找源站呢？（在DDoS和信息打点中这是必须学会的操作）
（零）根据原理，你用DNS探测的手段肯定找不出来，因为DNS只能解析到CDN上的节点IP，只能用其它方法。
（一）方法
0 拿下CDN，找出真实IP。最猛的方法。
1 查询DNS的历史记录：https://www.dnshistory.org。这种方法不一定准，因为域名可能换了IP地址。
2 爆破二级域名、三级域名等。如果这些域名没有走CDN，那么拿到的IP有可能是和源站一台主机或者一台反向代理。
3 通过网站邮件订阅查找。前提是域名有MX记录，你可以利用其邮件服务，继而找到MX服务器IP，MX服务器和源站大概率在一台机器上或者在一个网段中。
4 SSL证书探测。
5 通过国外主机ping对方网站。虽然不一定能找见（概率还是挺大的），但这个方法很好，因为准。
6 ping一个不存在的子域名。如果对方开了泛域名解析，将会返回真实IP。
7 网站漏洞查找：比如通过探针。
8 使用DDoS攻击耗尽CDN资源，使其源站被迫提供服务，继而暴露源站。但是这很难，因为CDN节点一般很多，对DDoS攻击的成本要求很高，个人很难发动这种攻击，一些有一定资金和规模的黑客组织会采用这种方法。
9 使用一些开源查询网站：censys：https://censys.io/，钟馗之眼：https://www.zoomeye.org/，Shodan：https://www.shodan.io/，FOFA：https://fofa.so/。实在万不得已的方法，不一定能找见，找见也不一定为真。